{% extends theme("layout.html") %}
{% import "_forms.html" as forms %}


{% block head %}
  {{ super() }}
  {% if page.comments and config.RSS and config.COMMENTS %}
    <link rel="alternate" type="application/atom+xml" title="comments" href="{{ url_for('frontend.comments_feeds', content_id=page.id) }}">
  {% endif %}
{% endblock %}

{% block content %}
  <h3>{{ page.title }}</h3>
  <h6 class="subheader">
  {% if page.published_date %}
    {{ page.published_date | date('EE dd MMMM YYYY') }} |
  {% endif %}
  <b>{{ page.author.name }}</b>
  </h6>
  {{ page.html | safe }}

  <!-- info -->
  <p>
    {% if page.category %}
      {{ _('Category') }} : <a href="{{ url_for('frontend.category', category_id=page.category.id) }}">{{ page.category.label }}</a>
    {% endif %}
    {% if page.tags %}
      {{ _('Tags') }} :
      {% for tag in page.tags %}
        <a href="{{ url_for('frontend.tag', tag_id=tag.id) }}">{{ tag.label }}</a>&nbsp;
      {% endfor %}
    {% endif %}
  </p>
  <!-- comments -->
  {% if config.COMMENTS and page.comments %}
    <div id="comment">
    <hr>
    {% with total=page.comments.all() | length %}
    <h5 style="text-align : right">{{ ngettext('%(num)s comment', '%(num)s comments', total) }}</h5>
      <ul>
      {% for comment in page.comments %}
        <a name="{{ comment.id }}"></a>
        <li>
            <div class="avatar" style="position : absolute; width : 60px;">
              <img src="{{ comment.avatar }}" alt="avatar">
            </div>
            <div class="comment_content" style="margin-left : 70px;">
              {% if comment.site %}
   	        <a href="{{ comment.site }}" target="_blank"><b>{{ comment.user }}</b></a>
    	      {% else %}
	        <b>{{ comment.user }}</b>
              {% endif %}
              <p>{{ comment.body }} </p>
              <span class="subheader">
                {{ comment.published_date | date('dd MM yyyy HH:mm') }}
              </span>
            </div>
        </li>
      {% endfor %}
      {% if config.RSS %}
        <li><a href="{{ url_for('frontend.comments_feeds', content_id=page.id) }}">{{ _('Comments feeds') }}</a></li>
      {% endif %}
    {% endwith %}
    </div>
  {% endif %}

  <!-- comment form -->
  {% if config.COMMENTS and form %}
    <h4>{{ _('Add a comment') }}</h4> 
    <form action="." method="post">
      {{ forms.render(form) }}
    </form>
  {% endif %}
{% endblock %}
